<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è•¨ç© | æ•¸æ“šç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-4 md:p-10">
    <div class="max-w-xl mx-auto space-y-8">
        <h1 class="text-3xl font-black text-slate-800">è•¨ç© ADMIN</h1>

        <div class="bg-white p-6 rounded-3xl shadow-xl">
            <h2 class="text-xl font-bold text-green-700 mb-6 italic">ğŸŒ¿ è¾²å ´æ•¸æ“šç™»éŒ„</h2>
            <form id="farmForm" class="space-y-4">
                <input type="text" name="batch_number" placeholder="æ‰¹è™Ÿ" class="w-full border p-4 rounded-2xl bg-gray-50 outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" name="plant_name" placeholder="æ¤ç‰©å“ç¨®" class="border p-4 rounded-2xl bg-gray-50">
                    <input type="number" name="quantity" placeholder="å…¥åº«æ•¸é‡" class="border p-4 rounded-2xl bg-gray-50">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" name="in_stock_date" class="border p-3 rounded-xl bg-gray-50">
                    <input type="date" name="out_stock_date" class="border p-3 rounded-xl bg-gray-50">
                </div>
                <div class="border-2 border-dashed p-6 rounded-2xl text-center">
                    <input type="file" id="photo" name="photo" accept="image/*" class="hidden">
                    <button type="button" onclick="document.getElementById('photo').click()" class="bg-gray-200 px-6 py-2 rounded-full text-sm font-bold">ğŸ“¸ æ‹æ”æˆ–é¸å–ç…§ç‰‡</button>
                    <p id="file-name" class="text-[10px] mt-2 text-gray-400 font-mono italic">å°šæœªé¸å–</p>
                </div>
                <button type="button" onclick="submitFarm()" id="btnFarm" class="w-full bg-green-600 text-white font-black py-4 rounded-2xl shadow-lg">å„²å­˜ä¸¦ä¸Šå‚³</button>
            </form>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-xl">
            <h2 class="text-xl font-bold text-blue-700 mb-6 italic">ğŸ—ï¸ æ–°å¢æ¡ˆå ´è³‡æ–™</h2>
            <div class="space-y-4">
                <input type="text" id="p_name" placeholder="æ¡ˆå ´åç¨±" class="w-full border p-4 rounded-2xl bg-gray-50 outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="p_area" placeholder="å¹³æ–¹ç±³" class="border p-4 rounded-2xl bg-gray-50">
                    <input type="number" id="p_plants" placeholder="éœ€æ±‚é‡" class="border p-4 rounded-2xl bg-gray-50">
                </div>
                <label class="flex items-center space-x-3 p-4 bg-gray-50 rounded-2xl">
                    <input type="checkbox" id="p_recycled" class="w-5 h-5"> <span class="text-sm font-bold">å¾ªç’°è³‡æ</span>
                </label>
                <button type="button" onclick="submitProject()" id="btnProject" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg">å»ºç«‹æ¡ˆå ´</button>
            </div>
        </div>
    </div>

    <script>
        // 1. æäº¤è¾²å ´æ•¸æ“š (åŒ…å«åœ–ç‰‡)
        async function submitFarm() {
            const btn = document.getElementById('btnFarm');
            const form = document.getElementById('farmForm');
            const formData = new FormData(form);

            btn.innerText = "æ­£åœ¨ä¸Šå‚³è‡³ä¼ºæœå™¨...";
            btn.disabled = true;

            try {
                const res = await fetch('/api/add_farm', { method: 'POST', body: formData });
                if (!res.ok) throw new Error("ä¼ºæœå™¨éŒ¯èª¤");
                alert("è¾²å ´æ•¸æ“šä¸Šå‚³æˆåŠŸï¼");
                location.reload();
            } catch (e) {
                alert("éŒ¯èª¤: " + e.message);
            } finally {
                btn.innerText = "å„²å­˜ä¸¦ä¸Šå‚³";
                btn.disabled = false;
            }
        }

        // 2. æäº¤æ¡ˆå ´æ•¸æ“š
        async function submitProject() {
            const btn = document.getElementById('btnProject');
            const data = {
                project_name: document.getElementById('p_name').value,
                area_sqm: parseFloat(document.getElementById('p_area').value) || 0,
                plant_total_count: parseInt(document.getElementById('p_plants').value) || 0,
                is_recycled: document.getElementById('p_recycled').checked
            };

            btn.innerText = "å»ºç«‹ä¸­...";
            btn.disabled = true;

            try {
                const res = await fetch('/api/add_project', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!res.ok) throw new Error("å»ºç«‹å¤±æ•—");
                alert("æ¡ˆå ´å»ºç«‹æˆåŠŸï¼");
                location.reload();
            } catch (e) {
                alert("éŒ¯èª¤: " + e.message);
            } finally {
                btn.innerText = "å»ºç«‹æ¡ˆå ´";
                btn.disabled = false;
            }
        }

        document.getElementById('photo').onchange = function() {
            document.getElementById('file-name').innerText = "å·²é¸å–: " + this.files[0].name;
        };
    </script>
</body>
</html>
