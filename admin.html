<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è•¨ç© | æ•¸æ“šç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-100 p-4 md:p-10 font-sans">
    <div class="max-w-xl mx-auto space-y-8">
        <h1 class="text-3xl font-black text-slate-800 tracking-tighter">è•¨ç© ADMIN</h1>

        <div class="bg-white p-6 rounded-3xl shadow-xl border border-white">
            <h2 class="text-xl font-bold text-green-700 mb-6 flex items-center">
                <span class="mr-2">ğŸŒ¿</span> è¾²å ´æ•¸æ“šç™»éŒ„
            </h2>
            <div class="space-y-4">
                <input type="text" id="batch_number" placeholder="æ‰¹è™Ÿ (ä¾‹å¦‚: B2026-001)" class="w-full border p-4 rounded-2xl bg-gray-50 outline-none focus:ring-2 focus:ring-green-500 transition">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="plant_name" placeholder="æ¤ç‰©å“ç¨®" class="border p-4 rounded-2xl bg-gray-50 outline-none">
                    <input type="number" id="farm_qty" placeholder="å…¥åº«æ•¸é‡ (æ ª)" class="border p-4 rounded-2xl bg-gray-50 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-gray-400 ml-2">é€²è²¨æ—¥æœŸ</label>
                        <input type="date" id="in_date" class="w-full border p-3 rounded-xl bg-gray-50">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-gray-400 ml-2">é è¨ˆå‡ºè²¨</label>
                        <input type="date" id="out_date" class="w-full border p-3 rounded-xl bg-gray-50">
                    </div>
                </div>
                
                <div class="bg-slate-50 border-2 border-dashed border-gray-200 p-6 rounded-2xl text-center">
                    <input type="file" id="photo_file" accept="image/*" class="hidden">
                    <button type="button" onclick="document.getElementById('photo_file').click()" class="bg-white px-6 py-2 rounded-full shadow-sm border text-sm font-bold hover:bg-gray-50 transition">ğŸ“¸ æ‹æ”æˆ–é¸å–ç…§ç‰‡</button>
                    <p id="upload-status" class="text-[10px] mt-3 text-gray-400 italic">å°šæœªé¸å–æª”æ¡ˆ</p>
                </div>

                <button type="button" id="btn-farm" onclick="submitFarm()" class="w-full bg-green-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-green-700 active:scale-95 transition">å„²å­˜è¾²å ´æ•¸æ“š</button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-xl border border-white">
            <h2 class="text-xl font-bold text-blue-700 mb-6 flex items-center">
                <span class="mr-2">ğŸ—ï¸</span> æ–°å¢æ¡ˆå ´è³‡æ–™
            </h2>
            <div class="space-y-4">
                <input type="text" id="p_name" placeholder="æ¡ˆå ´åç¨± (ä¾‹å¦‚: å°åŒ—å¤§å·¨è›‹)" class="w-full border p-4 rounded-2xl bg-gray-50 outline-none focus:ring-2 focus:ring-blue-500 transition">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="p_area" placeholder="å»ºç½®å¹³æ–¹ç±³" class="border p-4 rounded-2xl bg-gray-50 outline-none">
                    <input type="number" id="p_plants" placeholder="æ¤æ ½éœ€æ±‚é‡" class="border p-4 rounded-2xl bg-gray-50 outline-none">
                </div>
                <label class="flex items-center space-x-3 p-4 bg-gray-50 rounded-2xl cursor-pointer">
                    <input type="checkbox" id="p_recycled" class="w-5 h-5 rounded border-gray-300 text-blue-600">
                    <span class="text-sm font-bold text-gray-600">æœ¬æ¡ˆå ´ä½¿ç”¨å¾ªç’°è³‡æ</span>
                </label>
                <button type="button" id="btn-project" onclick="submitProject()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-blue-700 active:scale-95 transition">å»ºç«‹æ¡ˆå ´</button>
            </div>
        </div>
    </div>
<script>
    const supabaseUrl = 'https://fvvbmedluaipqiqjiujj.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2dmJtZWRsdWFpcHFpcWppdWpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4Nzc4NzYsImV4cCI6MjA4NzQ1Mzg3Nn0.U22L6P5HoyoPtEuoU5fhk8C5JZ-4-3O4vkQPzJeD9Uw'; 
    
    // åˆå§‹åŒ–æª¢æŸ¥
    let supabase;
    try {
        supabase = supabasejs.createClient(supabaseUrl, supabaseKey);
        console.log("âœ… Supabase å®¢æˆ¶ç«¯å·²å•Ÿå‹•");
    } catch (e) {
        console.error("âŒ Supabase åˆå§‹åŒ–å¤±æ•—:", e);
    }

    async function submitProject() {
        console.log("ğŸš€ æŒ‰éˆ•å·²æŒ‰ä¸‹ï¼šé–‹å§‹å»ºç«‹æ¡ˆå ´"); // å¦‚æœæ²’å°å‡ºé€™è¡Œï¼Œä»£è¡¨ HTML button æ²’é€£åˆ°é€™å€‹ function
        const btn = document.getElementById('btn-project');
        
        try {
            btn.innerText = "å»ºç«‹ä¸­...";
            btn.disabled = true;

            const payload = {
                project_name: document.getElementById('p_name').value,
                area_sqm: parseFloat(document.getElementById('p_area').value) || 0,
                plant_total_count: parseInt(document.getElementById('p_plants').value) || 0,
                is_recycled: document.getElementById('p_recycled').checked
            };
            console.log("ğŸ“¦ æº–å‚™é€å‡ºçš„è³‡æ–™:", payload);

            const res = await fetch('/api/add_project', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            console.log("ğŸ“¡ API å›å‚³ç‹€æ…‹:", res.status);
            
            if (!res.ok) {
                const errorData = await res.json();
                throw new Error(errorData.error || 'API å‚³é€å¤±æ•—');
            }
            
            alert('å»ºæ¡ˆå»ºç«‹æˆåŠŸï¼');
            location.reload();
        } catch (err) {
            console.error("âŒ ç™¼ç”ŸéŒ¯èª¤:", err);
            alert('éŒ¯èª¤: ' + err.message);
        } finally {
            btn.innerText = "å»ºç«‹æ¡ˆå ´";
            btn.disabled = false;
        }
    }
</script>
   
</body>
</html>
